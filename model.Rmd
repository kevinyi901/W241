# Abstract


# Introduction and Purpose


# Literature Review 


# Power Analysis

```{r power analysis }
# Calculate Power Value if 10% difference between treatment and control with 100 samples each. 

# Generate control values with 75% 0s (FB No Response) and 25% 1s (FB Response)
d1 <- data.table(treatment = rep(0, 500))
d1[, response := c(rep(0, 375), rep(1, 125))]

# Generate treatment values with 65% 0s and 35% 1s. Our treatment has a 10% increase in FB response than the control. 
d2 <- data.table(treatment = rep(1, 500))
d2[ , response := c(rep(0, 325), rep(1, 175))]

# Concatenate row-wise
data <- rbind(d1, d2)

# Check the average treatment effect (ATE)
ate <- mean(data$response[data$treatment == 1]) - mean(data$response[data$treatment == 0])
ate

# fill this in with the p-values from your power analysis
t_test_p_values <- rep(NA, 1000) 

for(sim in 1:1000) { 
    # Resample and randomly selects 100 treatment and 100 control without replacement
    sample <- data[, .SD[sample(.N, 100)], by = treatment] 

    # Run the t-test
   test_result <- t.test(response~treatment, data=sample)
    
    # Store Pvalue from the T.Test
    t_test_p_values[sim] <-  test_result$p.value
  }

# Find our power. Find P-value less than .05
reject_null_count<- sum(t_test_p_values<= 0.05)

power_value_10 <- reject_null_count/1000*100
power_value_10



# Calculate Power Value if 25% difference between treatment and control with 100 samples each. 

# Generate control values with 75% 0s (FB No Response) and 25% 1s (FB Response)
d1 <- data.table(treatment = rep(0, 500))
d1[, response := c(rep(0, 375), rep(1, 125))]

# Generate treatment values with 50% 0s and 50% 1s. Our treatment has a 10% increase in FB response than the control. 
d2 <- data.table(treatment = rep(1, 500))
d2[ , response := c(rep(0, 250), rep(1, 250))]

# Concatenate row-wise
data <- rbind(d1, d2)

# Check the average treatment effect (ATE)
ate <- mean(data$response[data$treatment == 1]) - mean(data$response[data$treatment == 0])
ate

# fill this in with the p-values from your power analysis
t_test_p_values <- rep(NA, 1000) 

for(sim in 1:1000) { 
    # Resample and randomly selects 100 treatment and 100 control without replacement
    sample <- data[, .SD[sample(.N, 100)], by = treatment] 

    # Run the t-test
   test_result <- t.test(response~treatment, data=sample)
    
    # Store Pvalue from the T.Test
    t_test_p_values[sim] <-  test_result$p.value
  }

# Find our power. Find P-value less than .05
reject_null_count<- sum(t_test_p_values<= 0.05)

power_value_25 <- reject_null_count/1000*100
power_value_25

```
With 100 sample in test and 100 sample in control, we would detect an ATE of 10% difference only 30.5% of the time and an ATE of 25% difference 97.6% of the time. 

# Hypothesis


# Methods/Modeling


## Data Cleaning
```{r load draft data}
d <- fread('./Datasci241 Experiment result - Combined.csv')

head(d)
```


```{r data cleaning, include=TRUE}
# Combine treatment categories to one column
d[, emoji := ifelse(non_facial_emoji == 1, "non facial emoji",
               ifelse(facial_emoji == 1, "facial emoji",
               ifelse(no_emoji == 1, "no emoji", NA_character_)))]

# Drop unused column 
d[, c("non_facial_emoji", "facial_emoji", "no_emoji", "seller_name", "counter", "response time", "condition", 
      "price", "V18", "Rough Numbers", "V20" , "V21") := NULL]



# Normalize all day values. 
d[day == "Fri", day := "Friday"]
d[day == "Mon", day := "Monday"]
d[day == "Sat", day := "Saturday"]
d[day == "Thu", day := "Thursday"]
d[day == "Tue", day := "Tuesday"]



# Convert to ITime using data.table's built-in function:
d[, msg_time := as.ITime(msg_time, format = "%H:%M:%S")]


head(d)
colSums(is.na(d))

```  
## Data Exploration

```{r data exploration, include=TRUE}

# Bar plot of emoji treatment to ensure balance
ggplot(d, aes(x = emoji)) +
  geom_bar() +
  labs(
    title = "Bar Plot of Emoji Types",
    x = "Emoji Type",
    y = "Count"
  )


# Bar plot of seller gender
ggplot(d, aes(x = seller_gender)) +
  geom_bar() +
  labs(
    title = "Bar Plot of Seller Gender",
    x = "Seller Gender",
    y = "Count"
  )


# Bar plot of day 
ggplot(d, aes(x = willing_to_reduce_price)) +
  geom_bar() +
  labs(
    title = "Willingess to Reduce Price",
    x = "Seller's Response",
    y = "Count"
  )


# Bar plot of Response
ggplot(d, aes(x = day)) +
  geom_bar() +
  labs(
    title = "Bar Plot of Day Message Sent",
    x = "Day",
    y = "Count"
  )


# Bar plot of location
ggplot(d, aes(x = location)) +
  geom_bar() +
  labs(
    title = "Bar Plot of Location",
    x = "Location",
    y = "Count"
  )


#Histogram of time message was sent
ggplot(d, aes(x = as.numeric(msg_time))) +
  geom_histogram(binwidth = 3600) +
  scale_x_continuous(
    breaks = seq(0, 24 * 3600, by = 3600),
    labels = function(x) format(as.ITime(x), "%H:%M")
  ) +
  labs(
    title = "Distribution of Message Times",
    x = "Time of Day (Hours)",
    y = "Count"
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)
  )
```  
```{r estimate basic model, include=TRUE}
model1 <- d[ , lm(willing_to_reduce_price~emoji)]
summary(model1)

```  

```{r estimate middle model, include=TRUE}
model2 <- d[ , lm(willing_to_reduce_price~ emoji + seller_gender )]
summary(model2)

```  

```{r estimate fully saturated model, include=TRUE}
model3 <- d[ , lm(willing_to_reduce_price~emoji + buyer + msg_time + day + price_drop + just_listed + seller_gender)]
summary(model3)

```  

```{r check covariate randomeness and collinearity , include=TRUE}
# Checking for randomness in covariate
# Do a F-test  to compare full model to model with no predictive features
null_model <- lm(willing_to_reduce_price ~ 1, data = d)
full_model <- lm(willing_to_reduce_price ~ 1+ emoji + buyer + msg_time + day + price_drop + just_listed + seller_gender, data = d)

# Perform an F-test
anova_mod <- anova(null_model, full_model, test = 'F')
anova_mod

# Check for multicollinearty
vif_values <- vif(full_model)
vif_values

```  


```{r estimate fully saturated model with Interaction, include=TRUE}
# Filter the data.table for only male sellers
d_male <- d[seller_gender == "M"]
# Filter the data.table for only female sellers
f_male <- d[seller_gender == "F"]

model_male <- d_male[, lm(willing_to_reduce_price ~ emoji + buyer + msg_time + day + price_drop + just_listed )]

model_female <- f_male [, lm(willing_to_reduce_price ~ emoji + buyer + msg_time + day + price_drop + just_listed )]

summary(model_male)
summary(model_female)

```  

# Results


# Discussion



# Conclusions








